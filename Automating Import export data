from selenium import webdriver
import re
import time
import datetime
import pandas as pd

data = pd.read_csv(r'C:\Users\MAYANK CHAUHAN\PycharmProjects\impexpcode\file.csv')
gst_no = data["gst no."]
finaldf = pd.DataFrame(columns=["gst no.", "legal name", "address","Trade Name","status"])

driver = webdriver.Chrome("chromedriver.exe")
address = "https://gstim4096:welcome2019@www.gstvalidator.com/~gst/~1.php"
driver.get(address)


def search(gst_no):
    gst_enter = driver.find_element_by_xpath("//*[@id='gst_number']")
    gst_enter.send_keys(gst_no)
    driver.find_element_by_xpath("//*[@id='gst_form_submit_button']").click()
    time.sleep(4)
    table = driver.find_element_by_xpath("//*[@id='contact']/div/div/div")
    global allData
    allData = []
    noofrows = len(table.find_elements_by_xpath("//tr"))
    print(noofrows)
    noofcolumns = len(table.find_elements_by_xpath("//tr[2]/td"))
    print(noofcolumns)
    for k in range(1, noofrows):
        ro = []
        for j in range(1, noofcolumns +1):
            ro.append(table.find_element_by_xpath("//tr[" + str(k) + "]/td[" + str(j) + "]").text)
        allData.append(ro)
    print(allData)

row = 0
for i in gst_no:
    search(i)
    finaldf.set_value(row, 'gst no.', i)
    for q in allData:
        finaldf.set_value(row, 'legal name', allData[0])
        finaldf.set_value(row, 'Trade Name', allData[4])
        finaldf.set_value(row, 'address', allData[5])
        finaldf.set_value(row, 'status', allData[9])
    row = row + 1
    finaldf.to_csv("D:/finalOutputgstnew.csv")
driver.quit()




